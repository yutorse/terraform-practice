# Chapter2

Q: `variable`ブロックで `default` に指定した値を参照するときに、プロパティアクセスをしなくてもいい理由は？

```
var.example_instance_type の参照は 常に可能
Terraform の変数は 必ず定義されている とみなされます

値がどこから来るかは次の優先順位で決まります:

1. CLI の -var オプション

2. .tfvars ファイルや terraform.tfvars

3. 環境変数（TF_VAR_変数名）

4. variable ブロックの default

5. どこにも値が無い場合 → apply 時にプロンプトで入力を求められる
```

Q: プロパティへのアクセス方法は？

```
リソースの参照ルール
Terraform では次の形で参照します。

<種類またはブロックタイプ>.<ローカル識別子>.<属性>
例:
- 変数: var.example_instance_type
- ローカル値: local.example_instance_type
- データソース: data.aws_ami.latest.id
- モジュール出力: module.web_server.instance_id
```

Q: terraform 本体とプロバイダの関係は？

```
あなたの.tfコード
    ↓
Terraform本体
    - HCLを解析
    - 差分を計算
    - "EC2を作れ"という命令を生成
    ↓
AWSプロバイダ
    - AWSのEC2 APIを呼び出す
    - レスポンスを受け取ってTerraform本体に返す
    ↓
Terraform本体
    - stateファイルに新しいリソースIDや状態を書き込む
```

Q: `file()`で呼び出すファイルのパスは、module 基準か、module 呼び出し元基準か？

呼び出し元の tf ファイルがあるパスを基準に解決される

Q: VPC と VPN の違いがあまりわかっていない

![](./images/スクリーンショット%202025-08-12%202.14.12.png)

Q. インターネットゲートウェイとは？

```
インターネットゲートウェイ（IGW）とは？
AWSのVPCとインターネットを接続するためのゲート（出口）。

これが無いと、パブリックIPを持っていてもインターネットにアクセスできない。

IGWは冗長構成（AWS側で自動的に冗長化）されており、特定のAZに依存しない。
```

Q. ルートテーブルとは？

```
ルートテーブルとは？
通信経路の地図 のようなもの。

「このIP宛の通信はどこへ送るか」を決める設定。

AWSでは、VPC作成時にメインルートテーブルが自動で作られるが、必要に応じて追加で作れる。

作成直後は、そのVPC内のローカル通信ルートだけを持っている（例: 10.0.0.0/16 → local）。
```

Q. EIP(Elastic IP) の役割は？

```
NATゲートウェイは、プライベートサブネットのインスタンスがインターネットへアクセスするときに送信元アドレスをこのEIPに変換して通信します。

これにより、外部のサービスからは「この固定IPからのアクセス」として見える。

IPが固定になることで、ファイアウォールやAPI制限がある外部サービスでもアクセスを許可しやすくなる。
```

Q. NAT ゲートウェイの役割は？

```
プライベートサブネット内のインスタンスが直接パブリックIPを持たずにインターネットにアクセスできるようにする。

外部からプライベートサブネット内に直接アクセスはできないため、セキュリティが高い。

NATゲートウェイを使うことでOSのアップデートや外部APIアクセスが可能になる。
```

Q. パブリックなサブネットに置かれている NAT ゲートウェイをどのように通して、外へ通信する？

```
NATゲートウェイとサブネット間の通信の流れ
プライベートサブネットのEC2インスタンスが外部に通信しようとする
　- インスタンスのルートテーブルに「0.0.0.0/0 → NATゲートウェイ」のルートが設定されている。

プライベートサブネットからのパケットはルートに従い、NATゲートウェイがあるパブリックサブネットへ送られる
　- ここで重要なのは、VPC内のネットワークはAZ内外問わず自由に通信できる点です。
　- つまりプライベートサブネットからパブリックサブネットへのルーティングはVPC内の内部通信として処理されます。

NATゲートウェイがプライベートIPアドレスを自分のパブリックIP（Elastic IP）に変換してインターネットへ通信を中継
　- 外部からはNATゲートウェイの固定IPでアクセスされる。
```
